{
  "rules": {

    "orders": {
      ".read": "auth != null",
      ".indexOn": ["timestamp", "status"],

      "$orderId": {
        ".write": "(!data.exists() && newData.exists()) || auth != null",

        ".validate": "newData.hasChildren(['orderCode', 'timestamp', 'status', 'personalInfo', 'package', 'shipping', 'payment'])",

        "orderCode": {
          ".validate": "newData.isString() && newData.val().matches(/^PRIME-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/)"
        },
        "status": {
          ".validate": "newData.isString() && (newData.val() === 'pending' || newData.val() === 'completed' || newData.val() === 'canceled')"
        },
        "timestamp": {
          ".validate": "newData.isString()"
        },

        "personalInfo": {
          ".validate": "newData.hasChildren(['fullName', 'email', 'phone', 'telegram'])",
          "fullName": {
            ".validate": "newData.isString() && newData.val().length >= 2 && newData.val().length <= 100"
          },
          "email": {
            ".validate": "newData.isString() && newData.val().contains('@') && newData.val().contains('.')"
          },
          "phone": {
            ".validate": "newData.isString() && newData.val().length >= 10 && newData.val().length <= 16"
          },
          "telegram": {
            ".validate": "newData.isString() && newData.val().length >= 2"
          }
        },

        "package": {
          ".validate": "newData.hasChildren(['name', 'price'])",
          "name": {
            ".validate": "newData.isString() && newData.val().length >= 1"
          },
          "price": {
            ".validate": "newData.isNumber() && newData.val() > 0 && newData.val() <= 500"
          }
        },

        "shipping": {
          ".validate": "newData.hasChildren(['method', 'methodPrice', 'address'])",
          "method": {
            ".validate": "newData.isString() && (newData.val() === 'standard' || newData.val() === 'express')"
          },
          "methodPrice": {
            ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
          },
          "type": {
            ".validate": "newData.isString()"
          },
          "address": {
            ".validate": "newData.hasChildren(['street', 'city', 'postalCode', 'country'])",
            "street": {
              ".validate": "newData.isString() && newData.val().length >= 5 && newData.val().length <= 200"
            },
            "city": {
              ".validate": "newData.isString() && newData.val().length >= 1 && newData.val().length <= 100"
            },
            "postalCode": {
              ".validate": "newData.isString() && newData.val().length >= 3 && newData.val().length <= 10"
            },
            "country": {
              ".validate": "newData.isString() && newData.val().length >= 2 && newData.val().length <= 60"
            }
          }
        },

        "payment": {
          ".validate": "newData.hasChildren(['method', 'total'])",
          "method": {
            ".validate": "newData.isString() && newData.val().length >= 1"
          },
          "total": {
            ".validate": "newData.isNumber() && newData.val() > 0 && newData.val() <= 1000"
          }
        },

        "cancelReason": {
          ".validate": "newData.isString()"
        },

        "$other": {
          ".validate": false
        }
      }
    },


    "posts": {
      ".read": true,
      ".indexOn": ["timestamp", "published"],

      "$postId": {
        ".write": "auth != null",

        ".validate": "newData.hasChildren(['content', 'timestamp'])",

        "title": {
          ".validate": "newData.isString() && newData.val().length <= 200"
        },
        "content": {
          ".validate": "newData.isString() && newData.val().length >= 1"
        },
        "imageUrl": {
          ".validate": "newData.isString()"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        },
        "views": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "likes": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "published": {
          ".validate": "newData.isBoolean()"
        },

        "$other": {
          ".validate": false
        }
      }
    },


    "reviews": {
      ".read": true,
      ".indexOn": ["timestamp", "approved"],

      "$reviewId": {
        ".write": "(!data.exists() && newData.exists()) || auth != null",

        ".validate": "newData.hasChildren(['name', 'rating', 'package', 'content', 'timestamp', 'date'])",

        "name": {
          ".validate": "newData.isString() && newData.val().length >= 2 && newData.val().length <= 50"
        },
        "rating": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 5"
        },
        "package": {
          ".validate": "newData.isString() && (newData.val() === 'starter' || newData.val() === 'premium' || newData.val() === 'ultimate')"
        },
        "content": {
          ".validate": "newData.isString() && newData.val().length >= 10 && newData.val().length <= 2000"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        },
        "date": {
          ".validate": "newData.isString()"
        },
        "verified": {
          ".validate": "newData.isBoolean()"
        },
        "helpful": {
          ".write": true,
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() === (data.exists() ? data.val() + 1 : 1)"
        },
        "approved": {
          ".validate": "newData.isBoolean()"
        },

        "$other": {
          ".validate": false
        }
      }
    },


    "$other": {
      ".read": false,
      ".write": false
    }
  }
}